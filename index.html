<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.23">
<title>Mellophone</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/*! Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment the following line when using as a custom stylesheet */
/* @import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700"; */
html{font-family:sans-serif;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
b,strong{font-weight:bold}
abbr{font-size:.9em}
abbr[title]{cursor:help;border-bottom:1px dotted #dddddf;text-decoration:none}
dfn{font-style:italic}
hr{height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type=checkbox],input[type=radio]{padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,::before,::after{box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;line-height:1;position:relative;cursor:auto;-moz-tab-size:4;-o-tab-size:4;tab-size:4;word-wrap:anywhere;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ul.square{list-style-type:square}
ul.circle ul:not([class]),ul.disc ul:not([class]),ul.square ul:not([class]){list-style:inherit}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:1px solid #dedede;word-wrap:normal}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre).nobreak{word-wrap:normal}
:not(pre).nowrap{white-space:nowrap}
:not(pre).pre-wrap{white-space:pre-wrap}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;border-radius:3px;box-shadow:0 1px 0 rgba(0,0,0,.2),inset 0 0 0 .1em #fff;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin:0 auto;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child{border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:flex;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border:1px solid #e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:none;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:hsla(0,0%,100%,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details{margin-left:1.25rem}
details>summary{cursor:pointer;display:block;position:relative;line-height:1.6;margin-bottom:.625rem;outline:none;-webkit-tap-highlight-color:transparent}
details>summary::-webkit-details-marker{display:none}
details>summary::before{content:"";border:solid transparent;border-left:solid;border-width:.3em 0 .3em .5em;position:absolute;top:.5em;left:-1.25rem;transform:translateX(15%)}
details[open]>summary::before{border:solid transparent;border-top:solid;border-width:.5em .3em 0;transform:translateY(15%)}
details>summary::after{content:"";width:1.25rem;height:1em;position:absolute;top:.3em;left:-1.25rem}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class=paragraph]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6);word-wrap:anywhere}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border:1px solid #e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;border-radius:4px}
.sidebarblock{border:1px solid #dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;border-radius:4px}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:first-child,.sidebarblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child,.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{border-radius:4px;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class=highlight],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos,pre.pygments .linenos{border-right:1px solid;opacity:.35;padding-right:.5em;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}
pre.pygments span.linenos{display:inline-block;margin-right:.75em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans-serif;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;font-size:.85rem;text-align:left;margin-right:0}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:1.25em;word-wrap:anywhere}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>*>tr>*{border-width:1px}
table.grid-cols>*>tr>*{border-width:0 1px}
table.grid-rows>*>tr>*{border-width:1px 0}
table.frame-all{border-width:1px}
table.frame-ends{border-width:1px 0}
table.frame-sides{border-width:0 1px}
table.frame-none>colgroup+*>:first-child>*,table.frame-sides>colgroup+*>:first-child>*{border-top-width:0}
table.frame-none>:last-child>:last-child>*,table.frame-sides>:last-child>:last-child>*{border-bottom-width:0}
table.frame-none>*>tr>:first-child,table.frame-ends>*>tr>:first-child{border-left-width:0}
table.frame-none>*>tr>:last-child,table.frame-ends>*>tr>:last-child{border-right-width:0}
table.stripes-all>*>tr,table.stripes-odd>*>tr:nth-of-type(odd),table.stripes-even>*>tr:nth-of-type(even),table.stripes-hover>*>tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
li>p:empty:only-child::before{content:"";display:inline-block}
ul.checklist>li>p:first-child{margin-left:-1em}
ul.checklist>li>p:first-child>.fa-square-o:first-child,ul.checklist>li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist>li>p:first-child>input[type=checkbox]:first-child{margin-right:.25em}
ul.inline{display:flex;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
td.hdlist2{word-wrap:anywhere}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:4px solid #fff;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active,#footnotes .footnote a:first-of-type:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);border-radius:50%;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt,summary{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,td.hdlist1,span.alt,summary{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]{border-bottom:1px dotted}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#header,#content,#footnotes,#footer{max-width:none}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media amzn-kf8,print{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
</head>
<body class="book toc2 toc-left">
<div id="header">
<h1>Mellophone</h1>
<div id="toc" class="toc2">
<div id="toctitle">Содержание</div>
<ul class="sectlevel0">
<li><a href="#_общие_сведения">Общие сведения</a>
<ul class="sectlevel1">
<li><a href="#_постановка_задачи">1. Постановка задачи</a></li>
<li><a href="#_применяемые_термины">2. Применяемые термины</a></li>
<li><a href="#_компоненты_решения_задачи">3. Компоненты решения задачи</a></li>
</ul>
</li>
<li><a href="#_сервлеты_сервера_аутентификации_и_протокол_работы_с_ними">Сервлеты сервера аутентификации и протокол работы с ними</a>
<ul class="sectlevel1">
<li><a href="#_сервлеты_для_прямых_запросов_с_серверов_веб_приложений">4. Сервлеты для прямых запросов с серверов веб-приложений</a></li>
<li><a href="#_сервлет_для_установки_стороннего_куки">5. Сервлет для установки стороннего куки</a>
<ul class="sectlevel2">
<li><a href="#_протокол_работы_веб_приложения_с_сервером_аутентификации">5.1. Протокол работы веб-приложения с сервером аутентификации</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_настройка_mellophone">Настройка Mellophone</a>
<ul class="sectlevel1">
<li><a href="#_общие_настройки">6. Общие настройки</a></li>
<li><a href="#_sql_провайдер_аутентификации">7. SQL-провайдер аутентификации</a>
<ul class="sectlevel2">
<li><a href="#_принцип_работы">7.1. Принцип работы</a></li>
<li><a href="#_параметры_настройки_в_файле_config_xml">7.2. Параметры настройки в файле config.xml</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#httpserver">HTTP-провайдер аутентификации</a>
<ul class="sectlevel1">
<li><a href="#_принцип_работы_2">8. Принцип работы</a>
<ul class="sectlevel2">
<li><a href="#_параметры_настройки_в_файле_config_xml_2">8.1. Параметры настройки в файле config.xml</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#sql">XML-файл-провайдер аутентификации</a>
<ul class="sectlevel1">
<li><a href="#_принцип_работы_3">9. Принцип работы</a></li>
<li><a href="#_параметры_настройки_в_файле_config_xml_3">10. Параметры настройки в файле config.xml</a></li>
<li><a href="#LDAPlink">11. LDAP-провайдер аутентификации</a></li>
<li><a href="#_принцип_работы_4">12. Принцип работы</a></li>
<li><a href="#_параметры_настройки_в_файле_config_xml_4">13. Параметры настройки в файле config.xml</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<h1 id="_общие_сведения" class="sect0">Общие сведения</h1>
<div class="openblock partintro">
<div class="content">
<div class="paragraph">
<p><strong>Mellophone</strong> — компонент платформы КУРС, специализированно решающий задачи аутентификации, кросс-доменной аутентификации, интеграции с различиными провайдерами аутентификации.</p>
</div>
<div class="paragraph">
<div class="title">Загрузить дистрибутив платформы Course Orchestra</div>
<p><a href="https://artifactory.corchestra.ru/artifactory/list/corchestra-dev/">Стабильные сборки</a></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_постановка_задачи">1. Постановка задачи</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Предположим, что на разных доменах (к примеру, www.domain-1.ru и www.domain-2.ru) развёрнуты разные веб-приложения.</p>
</div>
<div class="paragraph">
<p>Тот факт, что эти приложения развёрнуты на разных доменах, означает, что наборы сохраняемых браузером куков каждого из приложений индивидуальны и <em>полностью</em> изолированы друг от друга. То есть запрос на показ веб-страницы для приложения не будет содержать никаких данных о том, что пользователь был и авторизовывался ранее в каких-либо других приложениях.</p>
</div>
<div class="paragraph">
<p>Задача состоит в том, чтобы организовать общую авторизацию между несколькими веб-приложениями, то есть построить систему, благодаря которой пользователь, выполнивший аутентификацию в любом веб-приложении, при входе во все другие приложения также оказывался бы аутентифицирован, а при потере аутентификации в любом из приложений также переставал бы быть аутентифицированным для всех остальных приложений. За реализацию этого механизма отвечает сервер аутентификации, который может находиться на домене, отличающемся от доменов любого из приложений (к примеру, находиться в домене www.authentication-domain.ru), к нему за информацией должны обращаться как пользователь из браузера, так и напрямую взаимодействующие приложения (см. схему далее по тексту).</p>
</div>
<div class="paragraph">
<p>Для работоспособности этой схемы пользовательские браузеры должны поддерживать т. н. «сторонние куки».</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_применяемые_термины">2. Применяемые термины</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>В этом руководстве используется слово «<strong>аутентификация</strong>», означающее проверку «свой-чужой». Это слово следует отличать от слова «авторизация», означающее проверку, какими правами наделён «свой». Мы говорим только о системе аутентификации. Описываемая здесь система ничего не знает о ролях и правах аутентифицированного пользователя и не занимается ими.</p>
</li>
<li>
<p><strong>Провайдером аутентификации</strong> мы будем называть систему, которая по паре «логин/пароль» может выдать ответ «свой/чужой». Mellophone поддерживает работу со следующими типами провайдеров аутентификации:</p>
<div class="ulist">
<ul>
<li>
<p><a href="#LDAPlink">LDAP</a> в одном из двух вариантов:</p>
<div class="ulist">
<ul>
<li>
<p>Microsoft Active Directory ,</p>
</li>
<li>
<p>Apache DS (по протоколу LDAP),</p>
</li>
</ul>
</div>
</li>
<li>
<p>Текстовый файл в формате XML,</p>
</li>
<li>
<p><a href="#sql">База данных</a>,</p>
</li>
<li>
<p><a href="#httpserver">HTTP-сервер</a>.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Общая для всех приложений сессия аутентификации имеет «<strong>идентификатор сессии аутентификации</strong>», отличный от «<strong>идентификатора сессии приложения</strong>». У каждого веб-приложения имеется свой (известный только самому этому приложению и серверу аутентификации) идентификатор сессии приложения. Он хранится в куки, выставляемой на домен приложения. Идентификатор сессии аутентификации известен только самому серверу аутентификации и хранится в стороннем куки, выставленном на домен сервера аутентификации. Одному идентификатору сессии аутентификации может соответствовать какое угодно количество идентификаторов сессий приложений. Одному идентификатору сессии приложения может соответствовать ноль, означающий, что идентификатор сессии приложения не аутентифицирован, или единица, означающая, что идентификатор сессии приложения аутентифицирован и является идентификатором активной сессии аутентификации. Таблицу соответствия между идентификаторами сессий приложения и идентификаторами активных сессий аутентификации хранит сервер аутентификации.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>В некоторых случаях (для обеспечения дополнительной информационной защиты) приложению может понадобиться сменить идентификатор сессии приложения. Для отражения этого факта в Mellophone имеется специальный сервлет /changeappsesid.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_компоненты_решения_задачи">3. Компоненты решения задачи</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Для решения задачи применяются следующие составляющие:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Сервер аутентификации (Mellophone), на котором экспонированы:</p>
<div class="ulist">
<ul>
<li>
<p>сервлеты, обслуживающие прямые запросы с серверов веб-приложений;</p>
</li>
<li>
<p>один сервлет, обслуживающий запросы от клиентских браузеров, поступающих в виде запросов на отображение фрейма или картинки на странице веб-приложения.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Протокол, по которому любое веб-приложение может взаимодействовать с сервером аутентификации для обеспечения общей аутентификации.
##</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Для использования метода /authentication.gif mellophone потребует наличия ssl сертификата для https соединнеия.
Для этого можно будет либо настроить соединение на внешнем веб сервере (через который запросы проходят на mellophone), либо настроить сам mellophone (настройки tomcat для spring boot в application.yml), чтобы он использовал серитификат.</p>
</div>
</div>
</div>
<h1 id="_сервлеты_сервера_аутентификации_и_протокол_работы_с_ними" class="sect0">Сервлеты сервера аутентификации и протокол работы с ними</h1>
<div class="sect1">
<h2 id="_сервлеты_для_прямых_запросов_с_серверов_веб_приложений">4. Сервлеты для прямых запросов с серверов веб-приложений</h2>
<div class="sectionbody">
<div class="literalblock">
<div class="title">Сервлеты сервера аутентификации</div>
<div class="content">
<pre>skinparam dpi 300
skinparam shadowing false
skinparam rectangleBackgroundColor white
skinparam arrowColor black
skinparam noteBackgroundColor white
skinparam noteBorderColor black

rectangle app [
    **Приложение 1**
    domain-1.ru
]
note top of app
/login?sesid=...&amp;login=...&amp;pwd=...&amp;gp=...
/isauthenticated?sesid=...
/logout?sesid=...
end note

rectangle AuthServer [
    **AuthServer**
    authentication-domain.ru
]

rectangle browser [
    **Пользовательский браузер**
]

rectangle app2 [
    **Приложение 2**
    domain-2.ru
]

AuthServer &lt;== app
AuthServer &lt;== app2

note top of app2
/login?sesid=...&amp;login=...&amp;pwd=...&amp;gp=...
/isauthenticated?sesid=...
/logout?sesid=...
end note
app &lt;== browser
app2 &lt;== browser
AuthServer &lt;=== browser</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_сервлет_для_установки_стороннего_куки">5. Сервлет для установки стороннего куки</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_протокол_работы_веб_приложения_с_сервером_аутентификации">5.1. Протокол работы веб-приложения с сервером аутентификации</h3>
<div class="paragraph">
<p>Предполагается, что каждый запрос к веб-приложению происходит в контексте идентификатора сессии приложения. Apache Tomcat, любой другой сервлет-конейнер, PHP и многие другие системы для серверного программирования предоставляют в готовом виде механизм генерации и отслеживания идентификатора сессии приложения. Этими идентификаторами уместно пользоваться при общении с сервером аутентификации.</p>
</div>
<div class="paragraph">
<p>Если мы имеем дело с системой, которая в готовом виде не поддерживает механизм сессий приложения, то реализовать его можно таким образом:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>При каждом запросе страницы веб-приложения пытаться читать куки с идентификатором сессии приложения. Если оно найдено, то это означает, что мы находимся в соответствующем контексте.</p>
</li>
<li>
<p>Если соответствующее куки не найдено, то идентификатор сессии приложения следует сгенерировать с помощью криптостойкого генератора случайных чисел и сохранить в куки.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Описание протокола:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>При генерации страницы приложения по запросу пользователя сервером веб-приложения вызывается сервлет /isauthenticated?sesid=…. При положительном ответе страница приложения генерируется в зависимости от прав текущего пользователя. При отрицательном ответе формируется страница с полями для ввода логина и пароля (а куки sesid считается закрытой).</p>
</li>
<li>
<p>В любом случае страница веб-приложения должна содержать тэг:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;img src=”адрес.сервера.аутентификации/authentication.gif?sesid=...”/&gt;</code></pre>
</div>
</div>
</li>
<li>
<p>Страница веб-приложения с полями для ввода логина-пароля также должна содержать javascript, срабатывающий после загрузки страницы и определяющий, какой баннер загрузился. И если загрузился «цветной баннер», страница с полями логина-пароля должна перезагрузить сама себя (ибо так оказалось, что логин-пароль не нужен — в сторонних куках был идентификатор активной сессии аутентификации). Как Javascript узнает, какой баннер загрузился? Это можно сделать, например, если картинки будут отличаться по размеру на 1 пиксел. Узнать размер картинки можно с помощью кода:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-js" data-lang="js">var pic = document.getElementById(id); var h = pic.offsetHeight;  var w = pic.offsetWidth;</code></pre>
</div>
</div>
</li>
<li>
<p>Страница веб-приложения должна содержать кнопку разаутентификации, вызывающую ссылку: адрес.сервера.аутентификации/logout?sesid=&#8230;&#8203;</p>
</li>
</ol>
</div>
</div>
</div>
</div>
<h1 id="_настройка_mellophone" class="sect0">Настройка Mellophone</h1>
<div class="openblock partintro">
<div class="content">
<div class="paragraph">
<p>Файл настройки <strong>config.xml</strong> находится в поддиректории <strong>config</strong> директории установки приложения. Файл содержит общие настройки приложения и перечисление настроек провайдеров аутентификации в субтэгах корневого тэга config. Пример файла config.xml:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;config xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://www.curs.ru/authserver config.xsd" xmlns="http://www.curs.ru/authserver"&gt;
        &lt;!-- Общие настройки --&gt;
	&lt;common&gt;
         	&lt;threadcount&gt;4&lt;/threadcount&gt;
		&lt;authsessions initialCapacity="16" loadFactor="75" concurrencyLevel="16"/&gt;
		&lt;appsessions initialCapacity="16" loadFactor="75" concurrencyLevel="16"/&gt;
  	        &lt;lockouttime&gt;10&lt;/lockouttime&gt;
                &lt;loginattemptsallowed&gt;5&lt;/loginattemptsallowed&gt;
	        &lt;setsettingstoken&gt;43c42c2ee9210b0a77166a37f82bb4b6&lt;/setsettingstoken&gt;
   	        &lt;getuserlisttoken&gt;9ed41e1e40ff47208d8e0943b918a554&lt;/getuserlisttoken&gt;
                &lt;showtimetounlockuser&gt;true&lt;/showtimetounlockuser&gt;
                &lt;checkpasswordhashonly&gt;true&lt;/checkpasswordhashonly&gt;
	&lt;/common&gt;
        &lt;!-- Провайдер LDAP ApacheDS--&gt;
	&lt;ldapserver&gt;
    	        &lt;id&gt;test&lt;/id&gt;
   	        &lt;group_providers&gt;Группа1&lt;/group_providers&gt;
		&lt;logging&gt;true&lt;/logging&gt;
		&lt;servertype&gt;ApacheDS&lt;/servertype&gt;
		&lt;url&gt;ldap://localhost:10389&lt;/url&gt;
		&lt;usessl&gt;false&lt;/usessl&gt;
		&lt;sat&gt;Simple&lt;/sat&gt;
		&lt;searchbase&gt;ou=users,ou=system&lt;/searchbase&gt;
		&lt;searchreturningattributes
		  SID="entryUUID"
		  login="uid"
		  name="cn"
		  email="mail"
		  phone="homePhone"
		  organization = "o"
		  fax = "facsimileTelephoneNumber"
		/&gt;
		&lt;searchfilterforuser&gt;
		  (&amp;amp;(objectClass=inetOrgPerson)(uid=%s))
  	        &lt;/searchfilterforuser&gt;
		&lt;searchfilterforimport&gt;
		  (&amp;amp;(objectClass=inetOrgPerson))
		&lt;/searchfilterforimport&gt;
	&lt;/ldapserver&gt;
        &lt;!-- Провайдер LDAP ActiveDirectory--&gt;
	&lt;ldapserver&gt;
 	        &lt;id&gt;test2&lt;/id&gt;
   	        &lt;group_providers&gt;Группа1&lt;/group_providers&gt;
	        &lt;domain_name&gt;Office&lt;/domain_name&gt;
		&lt;logging&gt;true&lt;/logging&gt;
		&lt;servertype&gt;MSActiveDirectory&lt;/servertype&gt;
		&lt;url&gt;ldap://srv:389&lt;/url&gt;
		&lt;usessl&gt;false&lt;/usessl&gt;
		&lt;sat&gt;DIGEST_MD5&lt;/sat&gt;
		&lt;searchbase&gt;CN=Builtin,DC=curs,DC=ru&lt;/searchbase&gt;
		&lt;searchbase&gt;CN=Users,DC=curs,DC=ru&lt;/searchbase&gt;
		&lt;searchbase&gt;OU=Office,DC=curs,DC=ru&lt;/searchbase&gt;
		&lt;searchreturningattributes
		  SID="objectSid"
		  login="sAMAccountName"
		  name="name"
		  email="targetAddress"
		  phone="telephoneNumber"
		  organization = ""
		  fax = ""
		/&gt;
		&lt;searchfilterforuser&gt;
		  (&amp;amp;(objectCategory=person)(objectClass=user)(!(userAccountControl:1.2.840.113556.1.4.803:=2))(sAMAccountName=%s))
  	    &lt;/searchfilterforuser&gt;
		&lt;searchfilterforimport&gt;
		  (&amp;amp;(objectCategory=person)(objectClass=user)(!(userAccountControl:1.2.840.113556.1.4.803:=2)))
		&lt;/searchfilterforimport&gt;
	&lt;/ldapserver&gt;
        &lt;!-- Провайдер XML-файл--&gt;
	&lt;xmlfile&gt;
 	        &lt;id&gt;test3&lt;/id&gt;
   	        &lt;group_providers&gt;&lt;/group_providers&gt;
		&lt;logging&gt;true&lt;/logging&gt;
		&lt;url&gt;D:/workspace/mellophone/WebContent/config/users.xml&lt;/url&gt;
	&lt;/xmlfile&gt;
	&lt;!-- Провайдер база данных--&gt;
        &lt;sqlserver&gt;
	        &lt;id&gt;test4&lt;/id&gt;
 		&lt;logging&gt;true&lt;/logging&gt;
		&lt;url&gt;jdbc:sqlserver://BORIS2\\SQL8R2_RUS_TEST2:1145;databaseName=showcase&lt;/url&gt;
		&lt;connectionusername&gt;sa&lt;/connectionusername&gt;
		&lt;connectionpassword&gt;F708420Dx&lt;/connectionpassword&gt;
		&lt;table&gt;Пользователи&lt;/table&gt;
		&lt;fieldlogin&gt;Логин&lt;/fieldlogin&gt;
		&lt;fieldpassword&gt;Пароль&lt;/fieldpassword&gt;
		&lt;fieldblocked&gt;Заблокированный&lt;/fieldblocked&gt;
		&lt;hashalgorithm&gt;SHA-256&lt;/hashalgorithm&gt;
		&lt;localsecuritysalt&gt;0763bdd890421f02bba7bfe8b456c69f&lt;/localsecuritysalt&gt;
		&lt;procpostprocess&gt;postProcess&lt;/procpostprocess&gt;
		&lt;searchreturningattributes
		  SID="Поле objectSid"
		  login="Логин"
		  name="Поле name"
		  email="Поле email"
		  phone="Поле phone"
		  organization = ""
		  fax = "Поле fax"
		/&gt;
	&lt;/sqlserver&gt;
        &lt;!-- Провайдер HTTP--&gt;
	&lt;httpserver&gt;
		&lt;logging&gt;true&lt;/logging&gt;
		&lt;url&gt;http://info.ondp2012.ru/security/&lt;/url&gt;
		&lt;validateuser&gt;ValidateUser&lt;/validateuser&gt;
		&lt;userinfobyname&gt;User/%s&lt;/userinfobyname&gt;
		&lt;userinfobyid&gt;User/Id/%s&lt;/userinfobyid&gt;
	&lt;/httpserver&gt;
&lt;/config&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>В этом файле могут быть заданы настройки многих провайдеров аутентификации (успешно работают установки с десятками провайдеров аутентификации типа LDAP). Для увеличения скорости работы опрос провайдеров происходит в четыре параллельных потока выполнения. Пользователь считается аутентифицированным, если хотя бы один из провайдеров успешно аутентифицировал пользователя.</p>
</div>
<div class="paragraph">
<p>Подробное описание каждого из типов провайдеров аутентификации приводится далее.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_общие_настройки">6. Общие настройки</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><strong>threadcount</strong> - количество потоков, параллельно опрашивающих логин-провайдеры (значение по умолчанию 4),</p>
</li>
<li>
<p><strong>sessiontimeout</strong>(целое число) - время жизни сессии в минутах. Нуль или отсутствие значения говорит о бесконечном времени жизни сессии.</p>
</li>
<li>
<p><strong>lockouttime</strong> - время в минутах, на которое будет заблокирован пользователь после loginattemptsallowed неудачных попыток ввода пароля (значение по умолчанию 10).</p>
</li>
<li>
<p><strong>loginattemptsallowed</strong> - количество неудачных попыток ввода пароля до блокировки пользователя (значение по умолчанию 5).</p>
</li>
<li>
<p><strong>setsettingstoken</strong> - токен безопасности для сервлета /setsettings (значение по умолчанию null).</p>
</li>
<li>
<p><strong>getuserlisttoken</strong> - токен безопасности для сервлета /getuserlist (значение по умолчанию null).</p>
</li>
<li>
<p><strong>showtimetounlockuser</strong>(логическое) - показывать ли время, оставшееся до разблокировки пользователя, заблокированного по причине большого количества неудачных попыток ввода пароля.</p>
</li>
<li>
<p><strong>checkpasswordhashonly</strong>(логическое) - настройка типа проверки пароля при логине. Если true будет проверяться только хеш пароля, если false будут проверяться и хеш пароля, и сам пароль (значение по умолчанию false).</p>
</li>
<li>
<p>настройки списков аутентификации authsessions и сессий приложений appsessions</p>
<div class="ulist">
<ul>
<li>
<p><strong>initialCapacity</strong> - начальная емкость списка (значение по умолчанию 16),</p>
</li>
<li>
<p><strong>loadFactor</strong> - используется списком для определения, когда произойдет увеличение его размера по мере заполнения (значение по умолчанию 75%),</p>
</li>
<li>
<p><strong>concurrencyLevel</strong> - определяет количество сегментов, которое будет содержать список. Количество сегментов будет выбрано как ближайшая степень двойки, большая чем concurrencyLevel. При этом, занижение concurrencyLevel ведёт к тому, что более вероятны блокировки потоками сегментов списка при записи, завышение показателя ведёт к неэффективному использованию памяти (значение по умолчанию 16).</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Любые (или все) из этих настроек могут быть не заданы. В таком случае будут использоваться значения по умолчанию.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_sql_провайдер_аутентификации">7. SQL-провайдер аутентификации</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_принцип_работы">7.1. Принцип работы</h3>
<div class="paragraph">
<p>Этот провайдер работает с таблицей в базе данных, в полях которой хранится логин пользователя, хэшированный по SHA-1 пароль, а также дополнительная информация о пользователе, такая, как его имя, email и прочее.</p>
</div>
<div class="paragraph">
<p>Для простоты первоначальной настройки пароль можно указывать и в явном виде, после смены пароля пользователем в соответствующем поле будет храниться хэшированный пароль.</p>
</div>
</div>
<div class="sect2">
<h3 id="_параметры_настройки_в_файле_config_xml">7.2. Параметры настройки в файле config.xml</h3>
<div class="paragraph">
<p>Провайдер определяется тэгом <strong>sqlserver</strong>.</p>
</div>
<div class="paragraph">
<p>Параметры (субтэги):</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>id</strong> (строка) - идентификатор провайдера.</p>
</li>
<li>
<p><strong>logging</strong> (true/false) - выводить в лог события работы провайдера.</p>
</li>
<li>
<p><strong>group_providers</strong> (строка) - группа, к которой относится данный провайдер. Используется для ограничения множества провайдеров, в которые происходит попытка логина. Может быть пустой или отсутствовать. Конкретная группа передается в качестве параметра в сервлете логина, пользователь может иметь возможность явно выбирать группу провайдеров при подключении.</p>
</li>
<li>
<p><strong>url</strong> (строка) - JDBC URL подключения к серверу базы данных.</p>
</li>
<li>
<p><strong>searchreturningattributes</strong> (тэг с атрибутами) - содержит в себе указания, какие поля в записи следует интерпретировать в качестве SID, логина, электронной почты и т.п. пользователя системы. Атрибуты тэга searchreturningattributes следующие:</p>
<div class="ulist">
<ul>
<li>
<p><strong>SID</strong> - SID пользователя</p>
</li>
<li>
<p><strong>login</strong> - логин пользователя</p>
</li>
<li>
<p><strong>name</strong> - имя пользователя</p>
</li>
<li>
<p><strong>email</strong> - электронная почта пользователя</p>
</li>
<li>
<p><strong>phone</strong> - телефон пользователя</p>
</li>
<li>
<p><strong>organization</strong> - организация пользователя</p>
</li>
<li>
<p><strong>fax</strong> - факс пользователя</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>connectionusername</strong> (строка) - имя пользователя, от лица которого происходит подключение к базе данных.</p>
</li>
<li>
<p><strong>connectionpassword</strong> (строка) - пароль пользователя, от лица которого происходит подключение к базе данных.</p>
</li>
<li>
<p><strong>table</strong> (строка) - таблица, в которой находится перечень пользователей и их хэшированных паролей.</p>
</li>
<li>
<p><strong>fieldlogin</strong> (строка) - поле таблицы, в котором находятся имена пользователей.</p>
</li>
<li>
<p><strong>fieldpassword</strong> (строка) - поле таблицы, в котором находятся хэшированные пароли.</p>
</li>
<li>
<p><strong>fieldblocked</strong> (bit) - поле таблицы, в котором находится признак того, что пользователь является заблокированным. Настройка является необязательной. Значение по умолчанию false.</p>
</li>
<li>
<p><strong>hashalgorithm</strong> (строка) - алгоритм, используемый для хэширования пароля при создании нового пароля. Возможные значения:</p>
<div class="ulist">
<ul>
<li>
<p>MD2</p>
</li>
<li>
<p>MD5</p>
</li>
<li>
<p>SHA-1</p>
</li>
<li>
<p>SHA-224</p>
</li>
<li>
<p>SHA-256 (значение по умолчанию)</p>
</li>
<li>
<p>SHA-384</p>
</li>
<li>
<p>SHA-512</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>localsecuritysalt</strong> (строка) - "локальная" (в том смысле, что не хранится в базе данных) соль, используемая при расчете хеша пароля. Повышает устойчивость системы к взлому.
При этом, хеш пароля считается как HASH(password+salt+localsecuritysalt). Пароль хранится в базе в виде hashalgorithm#salt#hash</p>
</li>
<li>
<p><strong>procpostprocess</strong> (строка) - ф-ция постобработки проверки пользователя. Возвращает результат дополнительной проверки (true/false) и сообщение, выдаваемое пользователю. Пример ф-ции для MSSQL:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-sql" data-lang="sql">CREATE PROCEDURE [dbo].[postProcess]
@sesid varchar(256),
@userlogin varchar(256),
@userauth bit,
@userattributes varchar(1024),
@userip varchar(16),
@userlocked bit,
@userloginattempts int,
@usertimetounlock int,
@message varchar(512) output
AS
BEGIN
set @message = 'Пользователь не прошел проверку в функции постобработки со следующими параметрами: '
             '  sesid = '  ISNULL(@sesid, '')
             ', userlogin = '  ISNULL(@userlogin, '')
             ', userauth = '  CAST(@userauth AS CHAR(1))
             ', userattributes = '  ISNULL(@userattributes, '')
             ', userip = '  ISNULL(@userip, '')
             ', userlocked = '  CAST(@userlocked AS CHAR(1))
             ', userloginattempts = '  CAST(@userloginattempts AS CHAR(16))
             ', usertimetounlock = '  CAST(@usertimetounlock AS CHAR(16))
RETURN 1;
END</code></pre>
</div>
</div>
<div class="paragraph">
<p>Параметры:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>sesid</strong> - идентификатор сессии приложения,</p>
</li>
<li>
<p><strong>userlogin</strong> - логин пользователя,</p>
</li>
<li>
<p><strong>userauth</strong> - авторизован ли пользователь,</p>
</li>
<li>
<p><strong>userattributes</strong> - атрибуты пользователя (SID, телефон,&#8230;&#8203;),</p>
</li>
<li>
<p><strong>userip</strong> - ip адрес пользователя,</p>
</li>
<li>
<p><strong>userlocked</strong> - заблокирован ли пользователь,</p>
</li>
<li>
<p><strong>userloginattempts</strong> - число попыток авторизации пользователя,</p>
</li>
<li>
<p><strong>usertimetounlock</strong> - время в секундах до разблокировки пользователя, если он заблокирован по причине большого числа неудачных попыток авторизации,</p>
</li>
<li>
<p><strong>message</strong> - возвращаемое сообщение,</p>
</li>
<li>
<p><strong>RETURN 0/1</strong> - возвращаемый признак успешности проверки (0 - успешно, 1 - неуспешно)</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<h1 id="httpserver" class="sect0">HTTP-провайдер аутентификации</h1>
<div class="sect1">
<h2 id="_принцип_работы_2">8. Принцип работы</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Данный провайдер предполагает, что где-то реализован HTTP-сервис, содержащий в себе три сервлета:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>валидации логина/пароля (по запросу POST данный сервис обязан принимать XML вида:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;login name="User" password="pass" xmlns="http://www.curs.ru/ns/AuthServer"&gt;</code></pre>
</div>
</div>
</li>
<li>
<p>получения информации о пользователе по его логину</p>
</li>
<li>
<p>получения информации о пользователе по его GUID</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_параметры_настройки_в_файле_config_xml_2">8.1. Параметры настройки в файле config.xml</h3>
<div class="paragraph">
<p>Провайдер определяется тэгом <strong>httpserver</strong>.</p>
</div>
<div class="paragraph">
<p>Параметры (субтэги):</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>logging</strong> (true/false) - выводить в лог события работы провайдера.</p>
</li>
<li>
<p><strong>group_providers</strong> (строка) - группа, к которой относится данный провайдер. Используется для ограничения множества провайдеров, в которые происходит попытка логина. Может быть пустой или отсутствовать. Конкретная группа передается в качестве параметра в сервлете логина, пользователь может иметь возможность явно выбирать группу провайдеров при подключении.</p>
</li>
<li>
<p><strong>url</strong> (строка) - HTTP URL подключения к сервису HTTP.</p>
</li>
<li>
<p><strong>validateuser</strong> (строка) - имя сервлета проверки пары "логин/пароль" пользователя.</p>
</li>
<li>
<p><strong>userinfobyname</strong> (строка) - шаблон ссылки для доступа к информации о пользователе по его логину, где подстановкой %s обозначено место для вставки имени пользователя.</p>
</li>
<li>
<p><strong>userinfobyid</strong> (строка) - шаблон ссылки для доступа к информации о пользователе по его GUID, где подстановкой %s обозначено место для вставки GUID пользователя.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<h1 id="sql" class="sect0">XML-файл-провайдер аутентификации</h1>
<div class="sect1">
<h2 id="_принцип_работы_3">9. Принцип работы</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Это — наиболее простой провайдер. Он работает с файлом XML на диске. Формат этого файла предопределён (пример см. ниже), файле хранится логин пользователя, хэшированный по SHA-1 пароль, а также дополнительная информация о пользователе, такая, как его имя, email и прочее.</p>
</div>
<div class="paragraph">
<p>Для простоты первоначальной настройки пароль можно указывать и в явном виде, после смены пароля пользователем в соответствующем атрибуте будет храниться хэшированный пароль.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;users xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://www.curs.ru/authserver users.xsd" xmlns="http://www.curs.ru/authserver"&gt;
	&lt;user login="Иванов" password="пасс1"
		SID="8dbf2a31-cfe6-4188-a2f0-0125481355cd" name="Алексей В. Васильев"
		email="12@yandex.ru" phone="123-56-78" organization = "org1" fax = "fax1"/&gt;
	&lt;user login="Петров" password="c8233fc18a5fd0f87284d9fa971049891315ed84"
		SID="f2f0dbe5-da83-4367-9827-01e7c179ea3a" name="Борис В. Смирнов"
		email="34@yandex.ru" phone="784-23-f5" organization = "org2" fax = "fax2"/&gt;
	&lt;user login="Сидоров" password="пасс3"
		SID="5e599041-6a69-466e-b22c-f3003be536d9" name="Евгений Балмасов"
		email="56@yandex.ru" phone="апе-43-67" organization = "org3" fax = "fax3"/&gt;
        &lt;user login="user111" password="pwd111"
                SID="8dbf2a31-cfe6-4188-a2f0-0125481355ce" name="Алексей В. Васильев"
                email="12@yandex.ru" phone="123-56-78" organization = "org4" fax = "fax4"/&gt;
&lt;/users&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_параметры_настройки_в_файле_config_xml_3">10. Параметры настройки в файле config.xml</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Провайдер определяется тэгом <strong>xmlfile</strong>.</p>
</div>
<div class="paragraph">
<p>Параметры (субтэги):</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>id</strong> (строка) - идентификатор провайдера.</p>
</li>
<li>
<p><strong>logging</strong> (true/false) - выводить в лог события работы провайдера.</p>
</li>
<li>
<p><strong>group_providers</strong> (строка) - группа, к которой относится данный провайдер. Используется для ограничения множества провайдеров, в которые происходит попытка логина. Может быть пустой или отсутствовать. Конкретная группа передается в качестве параметра в сервлете логина, пользователь может иметь возможность явно выбирать группу провайдеров при подключении.</p>
</li>
<li>
<p><strong>url</strong> (строка) - полный путь к XML-файлу, содержащему данные о пользователях.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="LDAPlink">11. LDAP-провайдер аутентификации</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="_принцип_работы_4">12. Принцип работы</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Аутентификация по LDAP — наиболее предпочтительный для крупной организации вариант аутентификации, с её помощью можно добиться интеграции с ActiveDirectory и возможности входа пользователя под тем логином и паролем, под которым он входит в домен. Другой вариант — использование LDAP-сервера ApacheDS для хранения информации о пользователях.</p>
</div>
<div class="paragraph">
<p>Чтобы организовать аутентификацию по LDAP с ActiveDirectory, необходимо указать целый ряд параметров — адрес домен-контроллера, тип соединения, "ветки" директории, в которых будет осуществляться поиск пользователей.</p>
</div>
<div class="paragraph">
<p>Для предварительной проверки того факта, что эти опции верны, рекомендуется использовать инструмент <a href="https://directory.apache.org/studio/">Apache Directory Studio</a>.</p>
</div>
<div class="paragraph">
<p>Пример задаваемого текстом списка пользователей для сервера ApacheDS:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">version: 1
dn: ou=users,ou=system
objectClass: organizationalUnit
objectClass: top
ou: users
dn:: dWlkPdCh0LjQtNC+0YDQvtCyQXBhY2hlLG91PXVzZXJzLG91PXN5c3RlbQ==
objectClass: organizationalPerson
objectClass: person
objectClass: inetOrgPerson
objectClass: top
cn:: 0JDQu9C10LrRgdC10Lkg0JIuINCS0LDRgdC40LvRjNC10LI=
sn:: 0JLQsNGB0LjQu9GM0LXQsg==
facsimileTelephoneNumber: 2-987-65-43
homePhone: 2-123-45-67
mail: mail2
o:: 0L7RgNCz0LDQvdC40LfQsNGG0LjRjzI=
uid:: 0KHQuNC00L7RgNC+0LJBcGFjaGU=
userPassword:: e1NIQX16Z2p4aFl6ZWM1THNlSDVKZmdjdzBiQ0VIcnc9
dn:: dWlkPdCf0LXRgtGA0L7QskFwYWNoZSxvdT11c2VycyxvdT1zeXN0ZW0=
objectClass: organizationalPerson
objectClass: person
objectClass: inetOrgPerson
objectClass: top
cn:: 0JHQvtGA0LjRgSDQki4g0KHQvNC40YDQvdC+0LI=
sn:: 0KHQvNC40YDQvdC+0LI=
facsimileTelephoneNumber: 1-987-65-43
homePhone: 1-123-45-67
mail: mail1
o:: 0L7RgNCz0LDQvdC40LfQsNGG0LjRjzE=
uid:: 0J/QtdGC0YDQvtCyQXBhY2hl
userPassword:: e1NIQX15Q00vd1lwZjBQaHloTm42bHhCSmlSTVY3WVE9</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_параметры_настройки_в_файле_config_xml_4">13. Параметры настройки в файле config.xml</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Провайдер определяется тэгом <strong>ldapserver</strong>.</p>
</div>
<div class="paragraph">
<p>Параметры (субтэги):</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>id</strong> (строка) - идентификатор провайдера.</p>
</li>
<li>
<p><strong>logging</strong> (true/false) - выводить в лог события работы провайдера.</p>
</li>
<li>
<p><strong>group_providers</strong> (строка) - группа, к которой относится данный провайдер. Используется для ограничения множества провайдеров, в которые происходит попытка логина. Может быть пустой или отсутствовать. Конкретная группа передается в качестве параметра в сервлете логина, пользователь может иметь возможность явно выбирать группу провайдеров при подключении.</p>
</li>
<li>
<p><strong>servertype</strong>(MSActiveDirectory/ApacheDS) - тип LDAP-сервера: Microsoft ActiveDirectory или ApacheDS.</p>
</li>
<li>
<p><strong>url</strong> (строка) - адрес LDAP-сервера, начиная с "ldap://" и заканчивая, после двоеточия, портом.</p>
</li>
<li>
<p><strong>usessl</strong> (true/false) - использовать ли SSL при подключении к LDAP-серверу (пока не реализовано, нужно выставлять false).</p>
</li>
<li>
<p><strong>sat</strong> (None/Simple/DIGEST_MD5/GSSAPI) - тип аутентификации, одно из следующих значений:</p>
<div class="ulist">
<ul>
<li>
<p><strong>None</strong> - проверка имени пользователя и пароля не производится (может быть полезна, если сервер допускает анонимные соединения).</p>
</li>
<li>
<p><strong>Simple</strong> - пароль передается в незашифрованном виде.</p>
</li>
<li>
<p><strong>DIGEST_MD5</strong> - пароль передается в зашифрованном виде, используя алгортим DIGEST_MD5. Замечания по поводу аутентификации при помощи DIGEST_MD5: 1.В случае AD Windows необходимо, чтобы имя пользователя было sAMAccountName 2.Критические системные объекты (например, 'Administrator') использовать нельзя 3. В случае AD Windows 2000 необходимо, чтобы на сервере было установлено "reversible password encryption enabled".</p>
</li>
<li>
<p><strong>GSSAPI</strong> - аутентификация при помощи Kerberos.</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>domain_name</strong> (строка) - имя домена, связанное с данным LDAP-сервером. Опциональный параметр. В случае, если он указан, попытка логина в такой провайдер осуществляется два раза, один раз в формате "login", второй - в формате "domain_name\login".</p>
</li>
<li>
<p><strong>searchreturningattributes</strong> (тэг с атрибутами) - содержит в себе указания, какие атрибуты LDAP-объекта следует интерпретировать в качестве SID, логина, электронной почты и т.п. пользователя системы. Атрибуты тэга searchreturningattributes следующие:</p>
<div class="ulist">
<ul>
<li>
<p><strong>SID</strong> - SID пользователя</p>
</li>
<li>
<p><strong>login</strong> - логин пользователя</p>
</li>
<li>
<p><strong>name</strong> - имя пользователя</p>
</li>
<li>
<p><strong>email</strong> - электронная почта пользователя</p>
</li>
<li>
<p><strong>phone</strong> - телефон пользователя</p>
</li>
<li>
<p><strong>organization</strong> - организация пользователя</p>
</li>
<li>
<p><strong>fax</strong> - факс пользователя</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>searchbase</strong> (строка, может быть несколько) - база поиска пользователя в LDAP-дереве. Можно задать несколько баз, используя несколько тэгов searchbase.</p>
</li>
<li>
<p><strong>searchfilterforuser</strong> - LDAP-запрос для поиска пользователя по имени, где подстановкой %s обозначено место для вставки имени пользователя.</p>
</li>
<li>
<p><strong>searchfilterforimport</strong> - LDAP-запрос для поиска всех пользователей (для сервлета /getuserlist).</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2024-11-22 15:04:42 UTC
</div>
</div>
</body>
</html>